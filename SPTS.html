<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport"
		      content="width=device-width, height=device-height,
			       minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0">

		<title>SPTS</title>

		<style>
			@import url("https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap");
			html, body {
				margin: 0;
				font-family: 'Noto Sans KR', sans-serif;
			}
			body {
				background-image: url("pg.png");
				background-repeat: no-repeat;
				background-size: 100% 100%;
			}
			td {
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}
      
      
			select {
				-o-appearance: none;
				-webkit-appearance: none;
				-moz-appearance: none;
				appearance: none;

				width: 100%;
				margin: 7px 0 0 0;
				padding: 5px 0 5px 35px;

				color: #ffffff;
				background-color: #7cade7;

				border-radius: 5px;
				border : 1px solid #e7e7e7;
				box-shadow: 0 1px 0 1px rgba(0,0,0,.04);
			}
			select option {
				background: #f9f9f9;
				color: black;
				padding: 5px 0 5px 35px;
			}
			select:hover {
				border-color: #6382d5;
			}
			select:focus {
				border-color: #6382d5;
				box-shadow: 0 0 1px 1px rgba(99,130,213, .7);
				box-shadow: 0 0 0 1px -moz-mac-focusring;
				color: #e7e7e7;
				outline: none;
			}
			select:disabled {
				opacity: 0.5;
			}
      
      
			.bglayout {
				width: 100vw;
				height: 100vh;
				table-layout: fixed;
				border-collapse: collapse;
			}
			.controler {
				background-color: #f4fcff;
			}
			.panel {
				background-color: #ffffff;
				margin: 0px 40px 0px 20px;
				padding: 10px;
				border-radius: 10px;
				outline: solid 2px #e7e7e7;
			}
			.title {
				padding: 0px 0px 5px 10px;
				border-bottom: solid 1px #e7e7e7;
			}
      
			.controlpanel {
				padding: 5px 5px 5px 35px;
			}
			.statuspanel {
				padding: 5px 0px 0px 35px;
			}
			.shw {
				color: #ffffff;
				background-color: #7cade7;
				border-radius: 5px;
				width: 50px;
				text-align: center;
				margin: 0 auto;
			}
			.valuenum {
				width: 60%;
			}
      
			.traffic {
				width: 100%;
			}
			.lights {
				padding: 10px 10px 5px 10px;
				text-align: center;
			}
      
			.btn {
				margin: 3px 0px 0px 0px;

				color: #ffffff;
				background-color: #7cade7;
				border: 1px solid #7cade7;
				border-radius: 5px;
				width: 50px;
				height: 25px;
			}
			.btn:hover {
				box-shadow: 0 0 0 5px rgba(124,173,233, 0.7);
				animation: pulse 1s;
			}
			@keyframes pulse {
				from {
					box-shadow: 0 0 0 0 var(--btn-bg);
				}
			}
      
			.output {
				display : none;
				color: red;
			}
			#outputa{
				position: absolute;
				left: 80px;
				top: 10px;
			} 
			#outputc{
				position: absolute;
				left: 80px;
				top: 30px;
			} 
      
			.txtcenter {
				text-align: center;
			}
			.subtitlewth {
				width: 110px;
				min-width: 100px;
			}
			.paneltb {
				width: 15px;
				min-width: 5px;
				border-left: 1px solid #e7e7e7;
			}
			.tbclyt {
				padding-top: 3px;
				width: 100%;
				text-align: center;
			}
			.tbclytquarter {
				width: 25%;
				border: 3px solid #e7e7e7;
				border-radius: 10px;
				text-align: center;
				padding: 5px;
			}
			.tblayout {
				width: 90%;
				min-width: 250px;
			}
			.tblytcenter {
				width: 46%;
				min-width: 100px;
				text-align: center;
			}
			.tblyt {
				width: 23%;
				min-width: 50px;
				text-align: center;
			}
			.tblytright {
				width: 23%;
				min-width: 50px;
				text-align: right;
			}
			.tblytleft {
				width: 23%;
				min-width: 50px;
				text-align: left;
			}
			
			#s1c1, #s1c2, #s1c3, #s1c4, #s1c5, #s1c6, #s1c7, #s1c8, #s1c9, #s1c10, #s1c11, #s1c12, 
			#s2c1, #s2c2, #s2c3, #s2c4, #s2c5, #s2c6, #s2c7, #s2c8, #s2c9, #s2c10, #s2c11, #s2c12, 
			#s3c1, #s3c2, #s3c3, #s3c4, #s3c5, #s3c6, #s3c7, #s3c8, #s3c9, #s3c10, #s3c11, #s3c12, 
			#s4c1, #s4c2, #s4c3, #s4c4, #s4c5, #s4c6, #s4c7, #s4c8, #s4c9, #s4c10, #s4c11, #s4c12 {
				float: left;
				width: 20px;
				height: 15px;
				margin: 0 auto;
				text-align: center;
				vertical-align: middle;
				line-height: 15px; 
				
				display : none;
			}
		</style>
    
		<script type="text/javascript">
			// show input bar value
			function show_carnn() {
				document.getElementById("carshw").innerText = document.getElementById("carnum").value;
			}
			function show_speed() {
				document.getElementById("spdshw").innerText = document.getElementById("spdnum").value;
			}
			
			var color_st = ["White", "LightCoral", "Red", "Orange", "Yellow", "YellowGreen", "OliveDrab", 
					"SkyBlue", "Blue", "Navy", "Purple", "Gray", "Black"];
			var truck = [null,null,null,null,null,null,null,null,null,null,null];
			var crain_status = [0, 0, 0, 0, 0];
			
			// show senario
			function show_senario() {
				// reset
				drawMap();
				document.getElementById("carnum").style.pointerEvents = "auto";
				truck = [null,null,null,null,null,null,null,null,null,null,null];
				crain_status = [0, 0, 0, 0, 0];
				document.getElementById("outputt").innerHTML = "no data input";
				for(var c = 1; c <= 12; c++) {
					document.getElementById("s1c"+c).style.backgroundColor = color_st[c];
					document.getElementById("s2c"+c).style.backgroundColor = color_st[c];
					document.getElementById("s3c"+c).style.backgroundColor = color_st[c];
					document.getElementById("s4c"+c).style.backgroundColor = color_st[c];
					
					document.getElementById("s1c"+c).style.display = "none";
					document.getElementById("s2c"+c).style.display = "none";
					document.getElementById("s3c"+c).style.display = "none";
					document.getElementById("s4c"+c).style.display = "none";
					
					document.getElementById("s1c"+c).innerText = "";
					document.getElementById("s2c"+c).innerText = "";
					document.getElementById("s3c"+c).innerText = "";
					document.getElementById("s4c"+c).innerText = "";
				}
				
				// show senario in detail
				var senario = document.getElementById("senarioslct").selectedIndex+1;
				if(senario == 1) {
				}
				else if(senario == 2) {
					document.getElementById("s1c1").style.display = "block";
					document.getElementById("s2c2").style.display = "block";
					document.getElementById("s3c3").style.display = "block";
					document.getElementById("s4c4").style.display = "block";
					
					document.getElementById("s1c1").innerText = "99";
					document.getElementById("s2c2").innerText = "99";
					document.getElementById("s3c3").innerText = "99";
					document.getElementById("s4c4").innerText = "99";
				}
				else if(senario == 3) {			
					for(var c = 1; c <= 12; c++) {
						document.getElementById("s2c"+c).style.display = "block";
					}
				}
				else if(senario == 4) {			
					for(var c = 1; c <= 12; c++) {
						document.getElementById("s3c"+c).style.display = "block";
					}
				}
				else if(senario == 5) {				
					for(var c = 1; c <= 12; c++) {
						document.getElementById("s4c"+c).style.display = "block";
					}
				}
			}

			// draw map
			function drawMap() {				
				const canvas = document.getElementById('canvas');
				var ctx = canvas.getContext('2d');
				
				canvas.width  = window.innerWidth*0.635;
				canvas.height = window.innerHeight*0.793;
				
				var road = canvas.height*0.045;
				var wth  = canvas.width-8*road;
				
				// background
				ctx.fillStyle = 'rgb(255,255,255)';
				ctx.fillRect(0,0, canvas.width, canvas.height);
				
				// 바다
				ctx.fillStyle = "rgb(113, 156, 255)";
				ctx.fillRect (0, 0, 1500, road);
				
				// 선박
				ctx.fillStyle = "rgb(211, 211, 211)";
				ctx.fillRect (3*road+(wth/2-road)/4		, 0, 2*road, road);
				ctx.fillRect (3*road+(wth/2-road)/4*3		, 0, 2*road, road);
				ctx.fillRect (4*road+wth/2+(wth/2-road)/4	, 0, 2*road, road);
				ctx.fillRect (4*road+wth/2+(wth/2-road)/4*3	, 0, 2*road, road);
				
				// 하역 크레인
				ctx.fillStyle = "Pink";
				ctx.fillRect (3.5*road+(wth/2-road)/4		, 0, road, 2*road);
				ctx.fillRect (3.5*road+(wth/2-road)/4*3		, 0, road, 2*road);
				ctx.fillRect (4.5*road+wth/2+(wth/2-road)/4	, 0, road, 2*road);
				ctx.fillRect (4.5*road+wth/2+(wth/2-road)/4*3	, 0, road, 2*road);
				
				// 도로
				// 가로
				ctx.fillStyle = "rgb(150, 150, 150)";
				//ctx.fillRect (2*road,  2*road-1, wth+4*road, 2);
				ctx.fillRect (2*road,  3*road-1, wth+4*road, 2);
				//ctx.fillRect (2*road,  4*road-1, wth+4*road, 2);
				//ctx.fillRect (2*road,  8*road-1, wth+4*road, 2);
				ctx.fillRect (2*road,  9*road-1, wth+4*road, 2);
				//ctx.fillRect (2*road, 10*road-1, wth+4*road, 2);
				//ctx.fillRect (2*road, 14*road-1, wth+4*road, 2);
				ctx.fillRect (2*road, 15*road-1, wth+4*road, 2);
				//ctx.fillRect (2*road, 16*road-1, wth+4*road, 2);
				//ctx.fillRect (2*road, 20*road-1, wth+4*road, 2);
				ctx.fillRect (2*road, 21*road-1, wth+4*road, 2);
				//ctx.fillRect (2*road, 22*road-1, wth+4*road, 2);
				// 세로
				ctx.fillRect (2*road-1			,   road, 2, 21*road+1);
				ctx.fillRect (3*road-1			, 2*road, 2, 20*road  );
				ctx.fillRect ((wth-2*road)/2+5*road-1	, 2*road, 2, 20*road  );
				ctx.fillRect (wth+5*road-1		, 2*road, 2, 20*road  );
				ctx.fillRect (wth+6*road-1		,   road, 2, 21*road+1);
				
				// 적재된 컨테이너
				ctx.fillStyle = "rgb(176, 176, 228)";
				ctx.fillRect (4*road			,  5*road, (wth-2*road)/2, 2*road);
				ctx.fillRect ((wth-2*road)/2+6*road 	,  5*road, (wth-2*road)/2, 2*road);
				ctx.fillRect (4*road			, 11*road, (wth-2*road)/2, 2*road);
				ctx.fillRect ((wth-2*road)/2+6*road	, 11*road, (wth-2*road)/2, 2*road);
				ctx.fillRect (4*road			, 17*road, (wth-2*road)/2, 2*road);
				ctx.fillRect ((wth-2*road)/2+6*road	, 17*road, (wth-2*road)/2, 2*road);
				
				// 컨테이너 내부물품
				ctx.fillStyle = color_st[1];
				ctx.fillRect (4*road+(wth/2-road)*0.1		,  5*road+road/2  , (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[2];
				ctx.fillRect (4*road+(wth/2-road)*0.1		,  6*road+road/2-5, (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[3];
				ctx.fillRect (5*road+wth/2+(wth/2-road)*0.1	,  5*road+road/2  , (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[4];
				ctx.fillRect (5*road+wth/2+(wth/2-road)*0.1	,  6*road+road/2-5, (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[5];
				ctx.fillRect (4*road+(wth/2-road)*0.1		, 11*road+road/2  , (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[6];
				ctx.fillRect (4*road+(wth/2-road)*0.1		, 12*road+road/2-5, (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[7];
				ctx.fillRect (5*road+wth/2+(wth/2-road)*0.1	, 11*road+road/2  , (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[8];
				ctx.fillRect (5*road+wth/2+(wth/2-road)*0.1	, 12*road+road/2-5, (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[9];
				ctx.fillRect (4*road+(wth/2-road)*0.1		, 17*road+road/2  , (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[10];
				ctx.fillRect (4*road+(wth/2-road)*0.1		, 18*road+road/2-5, (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[11];
				ctx.fillRect (5*road+wth/2+(wth/2-road)*0.1	, 17*road+road/2  , (wth/2-road)*0.8, 5);
				ctx.fillStyle = color_st[12];
				ctx.fillRect (5*road+wth/2+(wth/2-road)*0.1	, 18*road+road/2-5, (wth/2-road)*0.8, 5);

				// 신호등
				ctx.fillStyle = "rgb(192, 244, 241)";
				ctx.fillRect(2*road+1,		 1*road, 2*road-2, 4*road);
				ctx.fillRect(2*road+1,		 7*road, 2*road-2, 4*road);
				ctx.fillRect(2*road+1,		13*road, 2*road-2, 4*road);
				ctx.fillRect(2*road+1,		19*road, 2*road-2, 3*road);
				ctx.fillRect(3*road+wth/2+1,	 1*road, 2*road-2, 4*road);
				ctx.fillRect(3*road+wth/2+1,	 7*road, 2*road-2, 4*road);
				ctx.fillRect(3*road+wth/2+1,	13*road, 2*road-2, 4*road);
				ctx.fillRect(3*road+wth/2+1,	19*road, 2*road-2, 3*road);
				ctx.fillRect(4*road+wth+1,	 1*road, 2*road-2, 4*road);
				ctx.fillRect(4*road+wth+1,	 7*road, 2*road-2, 4*road);
				ctx.fillRect(4*road+wth+1,	13*road, 2*road-2, 4*road);
				ctx.fillRect(4*road+wth+1,	19*road, 2*road-2, 3*road);
				
				// 도로
				// 가로
				ctx.fillStyle = "rgb(150, 150, 150)";
				ctx.fillRect (2*road,  2*road-1, wth+4*road, 2);
				ctx.fillRect (2*road,  4*road-1, wth+4*road, 2);
				ctx.fillRect (2*road,  8*road-1, wth+4*road, 2);
				ctx.fillRect (2*road, 10*road-1, wth+4*road, 2);
				ctx.fillRect (2*road, 14*road-1, wth+4*road, 2);
				ctx.fillRect (2*road, 16*road-1, wth+4*road, 2);
				ctx.fillRect (2*road, 20*road-1, wth+4*road, 2);
				ctx.fillRect (2*road, 22*road-1, wth+4*road, 2);
			}
			
			var stopani = null;
			
			function start() {
				document.getElementById("senarioslct").style.pointerEvents = "none";
				document.getElementById("carnum").style.pointerEvents = "none";
				
				const canvas = document.getElementById("canvas");
				var ctx = canvas.getContext("2d");
				
				var road = canvas.height*0.045;
				var wth  = canvas.width-8*road;
				
				class Truck {
					constructor(x, y, num) {
						// location
						this.x = x;
						this.y = y;
						
						// truck number
						this.num = num;
						
						// size
						this.sizex = road*0.9;
						this.sizey = this.sizex/3*5;
						
						// position detail
						this.dbx = 0;
						this.dby = 0;
						this.tlu = 0;
						this.tlr = 0;
						this.tld = 0;
						this.tll = 0;
						
						// status
						this.status = 0; // stop
						this.speed = 1;
						
						// get container
						this.crain = 0;
						this.container = 0;
						this.loading = 0;
						this.deloading = 0;
						this.ship = 0;
						
						// draw
						this.front = 1;
						
						// turn infront of traffic light
						// t_light 0=defalut -1=waiting 1~18=traffic light
						this.t_light = 0;
						this.turn = 0;
						this.enter = 0;
						
						// way to go
						this.cup = 0;
						this.cright = 0;
						this.cdown = 0;
						this.cleft = 0;
						
						// warning
						this.warnu = 0;
						this.warnr = 0;
						this.warnd = 0;
						this.warnl = 0;
					}
					update() {
						this.speed = parseInt(document.getElementById("spdnum").value);
						
						//get section position
						if     (this.x >= 2*road       	&& this.x < 3*road      ) {this.dbx =  1; this.tll = 2*road;		this.tlr = 3*road;		}
						else if(this.x >= 3*road       	&& this.x < 4*road      ) {this.dbx =  2; this.tll = 3*road; 		this.tlr = 4*road;		}
						else if(this.x >= 4*road       	&& this.x < 3*road+wth/2) {this.dbx =  3; this.tll = 4*road; 		this.tlr = 3*road+wth/2;}
						else if(this.x >= 3*road+wth/2 	&& this.x < 4*road+wth/2) {this.dbx =  4; this.tll = 3*road+wth/2; 	this.tlr = 4*road+wth/2;}
						else if(this.x >= 4*road+wth/2 	&& this.x < 5*road+wth/2) {this.dbx =  5; this.tll = 4*road+wth/2; 	this.tlr = 5*road+wth/2;}
						else if(this.x >= 5*road+wth/2 	&& this.x < 4*road+wth  ) {this.dbx =  6; this.tll = 5*road+wth/2; 	this.tlr = 4*road+wth;	}
						else if(this.x >= 4*road+wth   	&& this.x < 5*road+wth  ) {this.dbx =  7; this.tll = 4*road+wth; 	this.tlr = 5*road+wth;	}
						else if(this.x >= 5*road+wth   	&& this.x < 6*road+wth  ) {this.dbx =  8; this.tll = 5*road+wth; 	this.tlr = 6*road+wth;	}
						else if(this.x >= 6*road+wth				) {this.dbx =  9; this.tll = 6*road+wth; 	this.tlr = 9*road+wth;	}
						else							  {this.dbx =  0;							}
						
						if     (this.y >=    road 	&& this.y <  2*road 	) {this.dby =  1; this.tlu =    road; 		this.tld =  2*road;	}
						else if(this.y >=  2*road	&& this.y <  3*road 	) {this.dby =  2; this.tlu =  2*road; 		this.tld =  3*road;	}
						else if(this.y >=  3*road	&& this.y <  4*road 	) {this.dby =  3; this.tlu =  3*road; 		this.tld =  4*road;	}
						else if(this.y >=  4*road	&& this.y <  5*road 	) {this.dby =  4; this.tlu =  4*road; 		this.tld =  5*road;	}
						else if(this.y >=  5*road 	&& this.y <  7*road 	) {this.dby =  5; this.tlu =  5*road; 		this.tld =  7*road;	}
						else if(this.y >=  7*road 	&& this.y <  8*road 	) {this.dby =  6; this.tlu =  7*road; 		this.tld =  8*road;	}
						else if(this.y >=  8*road 	&& this.y <  9*road 	) {this.dby =  7; this.tlu =  8*road; 		this.tld =  9*road;	}
						else if(this.y >=  9*road 	&& this.y < 10*road 	) {this.dby =  8; this.tlu =  9*road; 		this.tld = 10*road;	}
						else if(this.y >= 10*road 	&& this.y < 11*road 	) {this.dby =  9; this.tlu = 10*road; 		this.tld = 11*road;	}
						else if(this.y >= 11*road 	&& this.y < 13*road 	) {this.dby = 10; this.tlu = 11*road; 		this.tld = 13*road;	}
						else if(this.y >= 13*road 	&& this.y < 14*road 	) {this.dby = 11; this.tlu = 13*road; 		this.tld = 14*road;	}
						else if(this.y >= 14*road 	&& this.y < 15*road 	) {this.dby = 12; this.tlu = 14*road; 		this.tld = 15*road;	}
						else if(this.y >= 15*road 	&& this.y < 16*road 	) {this.dby = 13; this.tlu = 15*road; 		this.tld = 16*road;	}
						else if(this.y >= 16*road 	&& this.y < 17*road 	) {this.dby = 14; this.tlu = 16*road; 		this.tld = 17*road;	}
						else if(this.y >= 17*road 	&& this.y < 19*road 	) {this.dby = 15; this.tlu = 17*road; 		this.tld = 19*road;	}
						else if(this.y >= 19*road 	&& this.y < 20*road 	) {this.dby = 16; this.tlu = 19*road; 		this.tld = 20*road;	}
						else if(this.y >= 20*road 	&& this.y < 21*road 	) {this.dby = 17; this.tlu = 20*road; 		this.tld = 21*road;	}
						else if(this.y >= 21*road 	&& this.y < 22*road 	) {this.dby = 18; this.tlu = 21*road; 		this.tld = 22*road;	}
						else							  {this.dby =  0;							}
						
						// get container
						// container 0=defalut -1=waiting 1~12=container
						// crain     0=defalut -1=waiting 1~3=crain
						if(this.container == 0) {
							if     (crain_status[1] == 0) {
								crain_status[1] = this.num;
								this.crain = 1;
								this.ship = 1;
								this.container = -1; // wait to get container
							}
							else if(crain_status[2] == 0) {
								crain_status[2] = this.num;
								this.crain = 2;
								this.ship = 2;
								this.container = -1;
							}
							else if(crain_status[3] == 0) {
								crain_status[3] = this.num;
								this.crain = 3;
								this.ship = 3;
								this.container = -1;
							}
							else if(crain_status[4] == 0) {
								crain_status[4] = this.num;
								this.crain = 4;
								this.ship = 4;
								this.container = -1;
							}
							else {
								this.crain = -1; // wait for crain
							}
						}
						
						// check if middle of road
						var u_middle = (this.tlu+this.tld)/2 <= this.y && (this.tlu+this.tld)/2 > this.y-this.speed;
						var r_middle = (this.tll+this.tlr)/2 >= this.x && (this.tll+this.tlr)/2 < this.x+this.speed;
						var d_middle = (this.tlu+this.tld)/2 >= this.y && (this.tlu+this.tld)/2 < this.y+this.speed;
						var l_middle = (this.tll+this.tlr)/2 <= this.x && (this.tll+this.tlr)/2 > this.x-this.speed;
						
						// set start position
						if(this.dbx == 9) {
							this.status = 1; // up
							
							if(this.crain == -1) {
								if(this.dby == 2 && u_middle) {
									this.y = (this.tlu+this.tld)/2;
									this.status = 0;
								}
							}
							else if(this.crain == 4) {
								if(this.dby == 1 && u_middle) {
									this.y = (this.tlu+this.tld)/2;
									this.status = 4;
								}
							}
							else {
								if(this.dby == 2 && u_middle) {
									this.y = (this.tlu+this.tld)/2;
									this.status = 4;
								}
							}
						}
						
						// move on road
						if	(this.dbx == 2 || this.dbx == 5 || this.dbx == 8) {
							if(this.dby == 5 || this.dby == 10 || this.dby == 15) {
								this.status = 1;
							}
							
						}
						else if	(this.dbx == 1 || this.dbx == 4 || this.dbx == 7) {
							if(this.dby == 5 || this.dby == 10 || this.dby == 15) {
								this.status = 3;
							}
						}
						else if	(this.dbx == 3 || this.dbx == 6) {
							if	(this.dby == 3 || this.dby == 4 || this.dby == 8 || this.dby == 9 || 
								 this.dby == 13 || this.dby == 14 || this.dby == 18) {
								this.status = 2;
							}
							else if	(this.dby == 2 || this.dby == 6 || this.dby == 7 || 
								 this.dby == 11 || this.dby == 12 || this.dby == 16 || this.dby == 17) {
								this.status = 4;
							}
						}
						
						var beforeCrain = [0, 3.5*road+(wth/2-road)/4, 3.5*road+(wth/2-road)/4*3, 4.5*road+wth/2+(wth/2-road)/4, 4.5*road+wth/2+(wth/2-road)/4*3];
						
						// go to crain and get container
						if(this.crain != 0 && this.crain > 0 && this.loading < 300) {
							if(this.crain != 4) {
								if(this.dby == 2 && beforeCrain[this.crain]+2*road > this.x) {
									this.status = 1; // up
								}
								if(this.dby == 1 && u_middle) {
									this.y = (this.tlu+this.tld)/2;
									this.status = 4; // left
								}
								if(this.dby == 1 && beforeCrain[this.crain]+road/2 > this.x) {
									this.status = 0; // stop
									this.loading += this.speed;
								}
							}
							else {
								if(this.dby == 1 && beforeCrain[this.crain]+road/2 > this.x) {
									this.status = 0;
									this.loading += this.speed;
								}
							}
						}
						
						// load container
						var senario = document.getElementById("senarioslct").selectedIndex+1;
						if(this.loading >= 300 && this.crain != 0 && this.dby == 1) {
							this.deloading = 0;
							getCrain(this.crain, senario);
							var crainch = document.getElementById('craincheck'+this.crain).innerText;
							if(crainch == 1) {
								this.container = document.getElementById('crain'+this.crain).innerText;
								document.getElementById('craincheck'+this.crain).innerText = "0";
								crain_status[this.crain] = 0;
								this.crain = 0;
							}
						}
						
						// go after load
						if(this.container > 0 && this.dbx != 1 && this.dbx != 4 && this.dby == 1) {
							this.status = 4;
						}
						
						// off container
						// move to side road
						if(beforeCrain[1] < this.x && this.dbx == 3 && (
						   (this.container == 1  && (this.dby == 3  || this.dby == 4 )) ||
						   (this.container == 5  && (this.dby == 8  || this.dby == 9 )) ||
						   (this.container == 9  && (this.dby == 13 || this.dby == 14)) )) {
							this.status = 3;
						}
						
						if(beforeCrain[2] > this.x && this.dbx == 3 && (
						   (this.container == 2  && (this.dby == 6  || this.dby == 7 )) ||
						   (this.container == 6  && (this.dby == 11 || this.dby == 12)) ||
						   (this.container == 10 && (this.dby == 16 || this.dby == 17)) )) {
							this.status = 1;
						}
						
						if(beforeCrain[3] < this.x && this.dbx == 6 && (
						   (this.container == 3  && (this.dby == 3  || this.dby == 4 )) ||
						   (this.container == 7  && (this.dby == 8  || this.dby == 9 )) ||
						   (this.container == 11 && (this.dby == 13 || this.dby == 14)) )) {
							this.status = 3;
						}
						
						if(beforeCrain[4] > this.x && this.dbx == 6 && (
						   (this.container == 4  && (this.dby == 6  || this.dby == 7 )) ||
						   (this.container == 8  && (this.dby == 11 || this.dby == 12)) ||
						   (this.container == 12 && (this.dby == 16 || this.dby == 17)) )) {
							this.status = 1;
						}
						
						// go to deloading location
						if(d_middle && this.dbx == 3 && (
						   (this.container == 1  && this.dby == 4 ) ||
						   (this.container == 5  && this.dby == 9 ) ||
						   (this.container == 9  && this.dby == 14) )) {
							this.y = (this.tlu+this.tld)/2;
							this.status = 2;
							if(this.warnr == 1) this.deloading+=this.speed;
						}
						
						if(u_middle && this.dbx == 3 && (
						   (this.container == 2  && this.dby == 6 ) ||
						   (this.container == 6  && this.dby == 11) ||
						   (this.container == 10 && this.dby == 16) )) {
							this.y = (this.tlu+this.tld)/2;
							this.status = 4;
							if(this.warnl == 1) this.deloading+=this.speed;
						}
						
						if(d_middle && this.dbx == 6 && (
						   (this.container == 3  && this.dby == 4 ) ||
						   (this.container == 7  && this.dby == 9 ) ||
						   (this.container == 11 && this.dby == 14) )) {
							this.y = (this.tlu+this.tld)/2;
							this.status = 2;
							if(this.warnr == 1) this.deloading+=this.speed;
						}
						
						if(u_middle > this.x && this.dbx == 6 && (
						   (this.container == 4  && this.dby == 6 ) ||
						   (this.container == 8  && this.dby == 11) ||
						   (this.container == 12 && this.dby == 16) )) {
							this.y = (this.tlu+this.tld)/2;
							this.status = 4;
							if(this.warnl == 1) this.deloading+=this.speed;
						}
						
						// deloading
						if(beforeCrain[2] < this.x && this.dbx == 3 && (
						   (this.container == 1  && this.dby == 4 ) ||
						   (this.container == 5  && this.dby == 9 ) ||
						   (this.container == 9  && this.dby == 14) )) {
							this.deloading+=this.speed;
							this.status = 0;
						}
						
						if(beforeCrain[1] > this.x && this.dbx == 3 && (
						   (this.container == 2  && this.dby == 6 ) ||
						   (this.container == 6  && this.dby == 11) ||
						   (this.container == 10 && this.dby == 16) )) {
							this.deloading+=this.speed;
							this.status = 0;
						}
						
						if(beforeCrain[4] < this.x && this.dbx == 6 && (
						   (this.container == 3  && this.dby == 4 ) ||
						   (this.container == 7  && this.dby == 9 ) ||
						   (this.container == 11 && this.dby == 14) )) {
							this.deloading+=this.speed;
							this.status = 0;
						}
						
						if(beforeCrain[3] > this.x && this.dbx == 6 && (
						   (this.container == 4  && this.dby == 6 ) ||
						   (this.container == 8  && this.dby == 11) ||
						   (this.container == 12 && this.dby == 16) )) {
							this.deloading+=this.speed;
							this.status = 0;
						}
						
						// deload and go
						if(this.container > 0 && this.deloading >= 300) {
							var cupdate = document.getElementById("s"+this.ship+"c"+this.container).innerText;
							document.getElementById("s"+this.ship+"c"+this.container).innerText = cupdate-1;
							
							this.container = 0;
							this.loading = 0;
							this.ship = 0;
						}
						
						
						// check if stop infront of traffic light
						var u_stop = this.tlu+this.sizey/2 <= this.y && this.tlu+this.sizey/2 > this.y-this.speed;
						var r_stop = this.tlr-this.sizex/2 >= this.x && this.tlr-this.sizex/2 < this.x+this.speed;
						var d_stop = this.tld-this.sizey/2 >= this.y && this.tld-this.sizey/2 < this.y+this.speed;
						var l_stop = this.tll+this.sizex/2 <= this.x && this.tll+this.sizex/2 > this.x-this.speed;
						
						// stop infront of traffic light
						if	((this.dbx == 9 && this.dby == 2 && l_stop) ||
							 (this.dbx == 3 && this.dby == 1 && l_stop) || 
							 (this.dbx == 6 && this.dby == 1 && l_stop)) {
							this.status = 0;
							this.x = this.tll+this.sizex/2;
							this.t_light = -1;
							this.enter = 6;
						}
						else if	(this.dbx == 2 || this.dbx == 5 || this.dbx == 8) {
							if(this.dby == 5 || this.dby == 10 || this.dby == 15) {
								if(u_stop) {
									this.status = 0;
									this.y = this.tlu+this.sizey/2;
									this.t_light = -1;
									this.enter = 1;
								}
							}
						}
						else if	(this.dbx == 1 || this.dbx == 4 || this.dbx == 7) {
							if(this.dby == 5 || this.dby == 10 || this.dby == 15) {
								if(d_stop) {
									this.status = 0;
									this.y = this.tld-this.sizey/2;
									this.t_light = -1;
									this.enter = 3;
								}
							}
						}
						else if	(this.dbx == 3 || this.dbx == 6) {
							if	(this.dby == 3 || this.dby == 8 || this.dby == 13 || this.dby == 18) {
								if(r_stop) {
									this.status = 0;
									this.x = this.tlr-this.sizex/2;
									this.t_light = -1;
									this.enter = 2;
								}
							}
							else if	(this.dby == 4 || this.dby == 9 || this.dby == 14) {
								if(r_stop) {
									this.status = 0;
									this.x = this.tlr-this.sizex/2;
									this.t_light = -1;
									this.enter = 5;
								}
							}
							else if	(this.dby == 2 || this.dby == 7 || this.dby == 12 || this.dby == 17) {
								if(l_stop) {
									this.status = 0;
									this.x = this.tll+this.sizex/2;
									this.t_light = -1;
									this.enter = 4;
								}
							}
							else if	(this.dby == 6 || this.dby == 11 || this.dby == 16) {
								if(l_stop) {
									this.status = 0;
									this.x = this.tll+this.sizex/2;
									this.t_light = -1;
									this.enter = 6;
								}
							}
						}
						
						// get traffic light
						if(this.status == 0 && this.t_light == -1) {						
							mysql_conn();
							var light = document.getElementById('outputt').innerHTML.split(" "); 
							
							// light  1
							if((this.dbx == 2 && this.dby == 5) || // up
							   (this.dbx == 3 && this.dby == 1) || // left
							   (this.dbx == 3 && this.dby == 2)) {
								this.t_light = light[1];
							}
							
							// light  2
							if((this.dbx == 5 && this.dby == 5) || // up
							   (this.dbx == 3 && this.dby == 3) || // right
							   (this.dbx == 3 && this.dby == 4) ||
							   (this.dbx == 6 && this.dby == 1) || // left
							   (this.dbx == 6 && this.dby == 2)) {
								this.t_light = light[2];
							}
							
							// light  3
							if((this.dbx == 8 && this.dby == 5) || // up
							   (this.dbx == 6 && this.dby == 3) || // right
							   (this.dbx == 6 && this.dby == 4) ||
							   (this.dbx == 9 && this.dby == 2)) { // left
								this.t_light = light[3];
							}
							
							// light  4
							if((this.dbx == 2 && this.dby == 10) || // up
							   (this.dbx == 1 && this.dby ==  5) || // down
							   (this.dbx == 3 && this.dby ==  6) || // left
							   (this.dbx == 3 && this.dby ==  7)) {
								this.t_light = light[4];
							}
							
							// light  5
							if((this.dbx == 5 && this.dby == 10) || // up
							   (this.dbx == 3 && this.dby ==  8) || // right
							   (this.dbx == 3 && this.dby ==  9) ||
							   (this.dbx == 4 && this.dby ==  5) || // down
							   (this.dbx == 6 && this.dby ==  6) || // left
							   (this.dbx == 6 && this.dby ==  7)) {
								this.t_light = light[5];
							}
							
							// light  6
							if((this.dbx == 8 && this.dby == 10) || // up
							   (this.dbx == 6 && this.dby ==  8) || // right
							   (this.dbx == 6 && this.dby ==  9) ||
							   (this.dbx == 7 && this.dby ==  5)) { // down
								this.t_light = light[6];
							}
							
							// light  7
							if((this.dbx == 2 && this.dby == 15) || // up
							   (this.dbx == 1 && this.dby == 10) || // down
							   (this.dbx == 3 && this.dby == 11) || // left
							   (this.dbx == 3 && this.dby == 12)) {
								this.t_light = light[7];
							}
							
							// light  8
							if((this.dbx == 5 && this.dby == 15) || // up
							   (this.dbx == 3 && this.dby == 13) || // right
							   (this.dbx == 3 && this.dby == 14) ||
							   (this.dbx == 4 && this.dby == 10) || // down
							   (this.dbx == 6 && this.dby == 11) || // left
							   (this.dbx == 6 && this.dby == 12)) {
								this.t_light = light[8];
							}
							
							// light  9
							if((this.dbx == 8 && this.dby == 15) || // up
							   (this.dbx == 6 && this.dby == 13) || // right
							   (this.dbx == 6 && this.dby == 14) ||
							   (this.dbx == 7 && this.dby == 10)) { // down
								this.t_light = light[9];
							}
							
							// light 10
							if((this.dbx == 1 && this.dby == 15) || // down
							   (this.dbx == 3 && this.dby == 16) || // left
							   (this.dbx == 3 && this.dby == 17)) {
								this.t_light = light[10];
							}
							
							// light 11
							if((this.dbx == 3 && this.dby == 18) || // right
							   (this.dbx == 4 && this.dby == 15) || // down
							   (this.dbx == 6 && this.dby == 16) || // left
							   (this.dbx == 6 && this.dby == 17)) {
								this.t_light = light[11];
							}
							
							// light 12
							if((this.dbx == 6 && this.dby == 18) || // right
							   (this.dbx == 7 && this.dby == 15)) { // down
								this.t_light = light[12];
							}
							
							
							// up right 1 / up left 2 / up up 3
							// right up 4 / right down 5 / right right 6
							// down left 7 / down right 8 / down down 9
							// left down 10 / left up 11 / left left 12
							
							// right up13 down14 right15  / left down16 up17 left18
							
							if	(this.t_light ==  1)	this.turn = 2;
							else if	(this.t_light ==  2)	this.turn = 3;
							else if	(this.t_light ==  3)	this.turn = 4;
							else if	(this.t_light ==  4)	this.turn = 2;
							else if	(this.t_light ==  5)	this.turn = 1;
							else if	(this.t_light ==  6)	this.turn = 2;
							else if	(this.t_light ==  7)	this.turn = 2;
							else if	(this.t_light ==  8)	this.turn = 3;
							else if	(this.t_light ==  9)	this.turn = 4;
							else if	(this.t_light == 10)	this.turn = 2;
							else if	(this.t_light == 11)	this.turn = 1;
							else if	(this.t_light == 12)	this.turn = 2;
							
							else if	(this.t_light == 13)	this.turn = 2;
							else if	(this.t_light == 14)	this.turn = 1;
							else if	(this.t_light == 15)	this.turn = 3;
							else if	(this.t_light == 16)	this.turn = 2;
							else if	(this.t_light == 17)	this.turn = 1;
							else if	(this.t_light == 18)	this.turn = 3;
						}
						
						// reset traffic light
						if(this.turn == 0) {
							this.t_light = 0;
							this.enter = 0;
						}
						
						// turn with traffic light
						if(this.t_light > 0 && this.enter == 1) {
							if	(this.t_light ==  1) { // up right
								this.status = 1;
								if(u_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 2;
									this.y = (this.tlu+this.tld)/2;
								}
							}
							else if	(this.t_light ==  2) { // up left
								this.status = 1;
								if(u_middle)		this.turn--;
								if(this.turn == 0) {	
									this.status = 4;
									this.y = (this.tlu+this.tld)/2;
								}
							}
							else if	(this.t_light ==  3) { // up up
								this.status = 1;
								if(u_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 1;
									this.y = (this.tlu+this.tld)/2;
								}
							}
						}
						if(this.t_light > 0 && this.enter == 2) {
							if	(this.t_light ==  4) { // right up
								this.status = 2;
								if(r_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 1;
									this.x = (this.tll+this.tlr)/2;
								}
							}
							else if	(this.t_light ==  5) { // right down
								this.status = 2;
								if(r_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 3;
									this.x = (this.tll+this.tlr)/2;
								}
							}
							else if	(this.t_light ==  6) { // right right
								this.status = 2;
								if(r_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 2;
									this.x = (this.tll+this.tlr)/2;
								}
							}
						}
						if(this.t_light > 0 && this.enter == 3) {
							if	(this.t_light ==  7) { // down left
								this.status = 3;
								if(d_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 4;
									this.y = (this.tlu+this.tld)/2;
								}
							}
							else if	(this.t_light ==  8) { // down right
								this.status = 3;
								if(d_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 2;
									this.y = (this.tlu+this.tld)/2;
								}
							}
							else if	(this.t_light ==  9) { // down down
								this.status = 3;
								if(d_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 3;
									this.y = (this.tlu+this.tld)/2;
								}
							}
						}
						if(this.t_light > 0 && this.enter == 4) {
							if	(this.t_light == 10) { // left down
								this.status = 4;
								if(l_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 3;
									this.x = (this.tll+this.tlr)/2;
								}
							}
							else if	(this.t_light == 11) { // left up
								this.status = 4;
								if(l_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 1;
									this.x = (this.tll+this.tlr)/2;
								}
							}
							else if	(this.t_light == 12) { // left left
								this.status = 4;
								if(l_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 4;
									this.x = (this.tll+this.tlr)/2;
								}
							}
						}
						if(this.t_light > 0 && this.enter == 5) {
							if	(this.t_light == 13) { // right up
								this.status = 2;
								if(r_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 1;
									this.x = (this.tll+this.tlr)/2;
								}
							}
							else if	(this.t_light == 14) { // right down
								this.status = 2;
								if(r_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 3;
									this.x = (this.tll+this.tlr)/2;
								}
							}
							else if	(this.t_light == 15) { // right up right 
								if(this.turn == 0.1) this.turn = 0;
								if(this.turn != 0.9) this.status = 2;
								if(r_middle && this.turn >= 2)	this.turn--;
								else if(u_middle && this.turn == 0.9) {
									this.y = (this.tlu+this.tld)/2;
									this.turn = 0.1;
								}
								if(this.turn == 1) {
									this.status = 1;
									this.x = (this.tll+this.tlr)/2;
									this.y = (this.tlu+this.tld)/2-1;
									this.turn = 0.9;
								}
								if(this.turn == 0.1) this.status = 2;
							} 
						}
						if(this.t_light > 0 && this.enter == 6) {
							if	(this.t_light == 16) { // left down
								this.status = 4;
								if(l_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 3;
									this.x = (this.tll+this.tlr)/2;
								}
							}
							else if	(this.t_light == 17) { // left up
								this.status = 4;
								if(l_middle)		this.turn--;
								if(this.turn == 0) {
									this.status = 1;
									this.x = (this.tll+this.tlr)/2;
								}
							}
							else if	(this.t_light == 18) { // left down left
								if(this.turn == 0.1) this.turn = 0;
								if(this.turn != 0.9) this.status = 4;
								if(l_middle && this.turn >= 2)	this.turn--;
								else if(d_middle && this.turn == 0.9) {
									this.y = (this.tlu+this.tld)/2;
									this.turn = 0.1;
								}
								if(this.turn == 1) {
									this.status = 3;
									this.x = (this.tll+this.tlr)/2;
									this.y = (this.tlu+this.tld)/2+1;
									this.turn = 0.9;
								}
								if(this.turn == 0.1) this.status = 4;
							}
						}
						
						// change the location
						if	(this.status == 1 && this.warnu == 0) { // up
							
							this.sizex = road*0.9;
							this.sizey = this.sizex/3*5;
							this.front = 1;
							
							this.y -= this.speed;
						}
						else if	(this.status == 2 && this.warnr == 0) { // right
							
							this.sizey = road*0.9;
							this.sizex = this.sizey/3*5;
							this.front = 2;
							
							this.x += this.speed;
						}
						else if	(this.status == 3 && this.warnd == 0) { // down
							
							this.sizex = road*0.9;
							this.sizey = this.sizex/3*5;
							this.front = 3;
							
							this.y += this.speed;
						}
						else if	(this.status == 4 && this.warnl == 0) { // left
							
							this.sizey = road*0.9;
							this.sizex = this.sizey/3*5;
							this.front = 4;
							
							this.x -= this.speed;
						}		
						
						document.getElementById("outx"+this.num).innerText = this.x;
						document.getElementById("outy"+this.num).innerText = this.y;
					}
					draw() {
						// draw truck
						ctx.fillStyle = "rgb(9, 96, 47)";
						ctx.fillRect(this.x-1, this.y-1, this.sizex/2+1		, this.sizey/2+1	);
						ctx.fillRect(this.x  , this.y  , this.sizex/2		, (this.sizey/2)*(-1)	);
						ctx.fillRect(this.x  , this.y  , (this.sizex/2)*(-1)	, this.sizey/2		);
						ctx.fillRect(this.x+1, this.y+1, (this.sizex/2)*(-1)-1	, (this.sizey/2)*(-1)-1	);
						
						// draw color value of each truck
						for(var i = 1; i <= 10; i++) {
							if(this.num == i)	ctx.fillStyle = color_st[i];
						}
						
						if	(this.front == 1)	ctx.fillRect(this.x-5			, this.y-this.sizey/2	, 10, 4);
						else if (this.front == 2)	ctx.fillRect(this.x+this.sizex/2-4	, this.y-5		, 4, 10);
						else if (this.front == 3)	ctx.fillRect(this.x-5			, this.y+this.sizey/2-4	, 10, 4);
						else if (this.front == 4)	ctx.fillRect(this.x-this.sizex/2	, this.y-5		, 4, 10);
						
						// check crain
						if(crain_status[1] != 0) {
							ctx.fillStyle = color_st[crain_status[1]];
							ctx.fillRect (3.5*road+(wth/2-road)/4		, road/2-2, road, 4);
						}
						if(crain_status[2] != 0) {
							ctx.fillStyle = color_st[crain_status[2]];
							ctx.fillRect (3.5*road+(wth/2-road)/4*3		, road/2-2, road, 4);
						}
						if(crain_status[3] != 0) {
							ctx.fillStyle = color_st[crain_status[3]];
							ctx.fillRect (4.5*road+wth/2+(wth/2-road)/4	, road/2-2, road, 4);
						}
						if(crain_status[4] != 0) {
							ctx.fillStyle = color_st[crain_status[4]];
							ctx.fillRect (4.5*road+wth/2+(wth/2-road)/4*3	, road/2-2, road, 4);
						}
						
						// load container
						if(this.container > 0) {
							ctx.fillStyle = color_st[this.container];
							
							if     (this.front == 1)	ctx.fillRect(this.x-this.sizex/2, this.y+this.sizey/2-this.sizex/2, this.sizex, 2);
							else if(this.front == 2)	ctx.fillRect(this.x-this.sizex/2-2+this.sizey/2, this.y-this.sizey/2, 2, this.sizey);
							else if(this.front == 3)	ctx.fillRect(this.x-this.sizex/2, this.y-this.sizey/2-2+this.sizex/2, this.sizex, 2);
							else if(this.front == 4)	ctx.fillRect(this.x+this.sizex/2-this.sizey/2, this.y-this.sizey/2, 2, this.sizey);
						}
						
						/*
						if(this.warnu == 1)	ctx.fillRect(this.x-this.sizex/2, this.y-this.sizey/2-5, this.sizex, 5);
						if(this.warnr == 1)	ctx.fillRect(this.x+this.sizex/2, this.y-this.sizey/2, 5, this.sizey);
						if(this.warnd == 1)	ctx.fillRect(this.x-this.sizex/2, this.y+this.sizey/2, this.sizex, 5);
						if(this.warnl == 1)	ctx.fillRect(this.x-this.sizex/2-5, this.y-this.sizey/2, 5, this.sizey);
						*/
					}
					check() {
						this.warnu = 0;
						this.warnr = 0;
						this.warnd = 0;
						this.warnl = 0;
						
						const totalcarnum = document.getElementById("carnum").value;
						var chx = null;
						var chy = null;
						var thiscar = parseInt(this.num);
						
						for(var i = 1; i <= totalcarnum; i++) {
							if(i != thiscar) {
								chx = document.getElementById("outx"+i).innerText;
								chy = document.getElementById("outy"+i).innerText;
								if(Math.sqrt(Math.pow(Math.abs(this.x-chx), 2) + Math.pow(Math.abs(this.y-chy), 2)) < Math.max(this.sizex, this.sizey)/2*3) {	
									if(this.x+this.sizex > chx && this.x-this.sizex < chx && this.y > chy) {
										this.warnu = 1;
									}
									if(this.y+this.sizey > chy && this.y-this.sizey < chy && this.x < chx) {
										this.warnr = 1;
									}
									if(this.x+this.sizex > chx && this.x-this.sizex < chx && this.y < chy) {
										this.warnd = 1;
									}
									if(this.y+this.sizey > chy && this.y-this.sizey < chy && this.x > chx) {
										this.warnl = 1;
									}
								}
							}
						}
					}
				}
				
				const numcar = document.getElementById("carnum").value;
				var park = 85;
				init = () => {
					for(var i = 1; i <= numcar; i++) {
						truck[i] = new Truck(canvas.width-41, i*park, i);
					}
					
					mysql_conn();
				}
				
				function animate() {
					drawMap();
						
					for(var i = 1; i <= numcar; i++) {
						truck[i].check();
					}
						
					for(var i = 1; i <= numcar; i++) {
						truck[i].update();
						truck[i].draw();
					}
						
					stopani = requestAnimationFrame(animate);
				}
				var nodata = document.getElementById("outputt").innerHTML;
				if(nodata == "no data input") init();
				animate();
			}
			
			function stop() {
				document.getElementById("senarioslct").style.pointerEvents = "auto";
				cancelAnimationFrame(stopani);
			}
		</script>
    
	</head>
	<body>
		<table class="bglayout">
			<tr>
				<td class="txtcenter" colspan="2" rowspan="5" width="70%">
					<div id="map">
						<canvas id="canvas" width="100" height="100"></canvas>
					</div>
					<br>
					<br>
				</td>
				<th class="title">
					<br>
					Smart Port Traffic Simulator
				</th>
			</tr>
			<tr>
				<td class="controler">
					<div class="panel">
						<div class="title">
							시나리오 선택
							<div class="output" id="outputc">
								<i class="output" id="outx1">0</i>
								<i class="output" id="outy1">0</i>
								<i class="output" id="outx2">0</i>
								<i class="output" id="outy2">0</i>
								<i class="output" id="outx3">0</i>
								<i class="output" id="outy3">0</i>
								<i class="output" id="outx4">0</i>
								<i class="output" id="outy4">0</i>
								<i class="output" id="outx5">0</i>
								<i class="output" id="outy5">0</i>
								<i class="output" id="outx6">0</i>
								<i class="output" id="outy6">0</i>
								<i class="output" id="outx7">0</i>
								<i class="output" id="outy7">0</i>
								<i class="output" id="outx8">0</i>
								<i class="output" id="outy8">0</i>
								<i class="output" id="outx9">0</i>
								<i class="output" id="outy9">0</i>
								<i class="output" id="outx10">0</i>
								<i class="output" id="outy10">0</i>
							</div>
						</div>
						<select id="senarioslct" onchange="show_senario()">
							<option value="1" selected>#1</option>
							<option value="2">#2</option>
							<option value="3">#3</option>
							<option value="4">#4</option>
							<option value="5">#5</option>
						</select>
						<table class="tbclyt">
							<tr>
								<td class="tbclytquarter">
									<div id="s1c1"></div>
									<div id="s1c2"></div>
									<div id="s1c3"></div>
									<div id="s1c4"></div>
									<div id="s1c5"></div>
									<div id="s1c6"></div>
									<div id="s1c7"></div>
									<div id="s1c8"></div>
									<div id="s1c9"></div>
									<div id="s1c10"></div>
									<div id="s1c11"></div>
									<div id="s1c12"></div>
								</td>
								<td class="tbclytquarter">
									<div id="s2c1"></div>
									<div id="s2c2"></div>
									<div id="s2c3"></div>
									<div id="s2c4"></div>
									<div id="s2c5"></div>
									<div id="s2c6"></div>
									<div id="s2c7"></div>
									<div id="s2c8"></div>
									<div id="s2c9"></div>
									<div id="s2c10"></div>
									<div id="s2c11"></div>
									<div id="s2c12"></div>
								</td>
								<td class="tbclytquarter">
									<div id="s3c1"></div>
									<div id="s3c2"></div>
									<div id="s3c3"></div>
									<div id="s3c4"></div>
									<div id="s3c5"></div>
									<div id="s3c6"></div>
									<div id="s3c7"></div>
									<div id="s3c8"></div>
									<div id="s3c9"></div>
									<div id="s3c10"></div>
									<div id="s3c11"></div>
									<div id="s3c12"></div>
								</td>
								<td class="tbclytquarter">
									<div id="s4c1"></div>
									<div id="s4c2"></div>
									<div id="s4c3"></div>
									<div id="s4c4"></div>
									<div id="s4c5"></div>
									<div id="s4c6"></div>
									<div id="s4c7"></div>
									<div id="s4c8"></div>
									<div id="s4c9"></div>
									<div id="s4c10"></div>
									<div id="s4c11"></div>
									<div id="s4c12"></div>
								</td>
							</tr>
						</table>
					</div>
				</td>
			</tr>
			<tr>
				<td class="controler">
					<div class="panel">
						<div class="title">
							신호등 지시 현황
							<i class="output" id="outputa">
								{"light01":"0","light02":"0","light03":"0","light04":"0","light05":"0","light06":"0",
								"light07":"0","light08":"0","light09":"0","light10":"0","light11":"0","light12":"0"}
							</i>
						</div>
						<table class="traffic">
							<tr>
								<td class="lights" id="l1" ><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
								<td class="lights" id="l2" ><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
								<td class="lights" id="l3" ><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
							</tr>
							<tr>
								<td class="lights" id="l4" ><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
								<td class="lights" id="l5" ><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
								<td class="lights" id="l6" ><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
							</tr>
							<tr>
								<td class="lights" id="l7" ><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
								<td class="lights" id="l8" ><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
								<td class="lights" id="l9" ><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
							</tr>
							<tr>
								<td class="lights" id="l10"><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
								<td class="lights" id="l11"><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
								<td class="lights" id="l12"><img src="stay.png" width="45%" style="transform:rotate(270deg);"/></td>
							</tr>
						</table>
					</div>
				</td>
			</tr>
			<tr>
				<td class="controler">
					<div class="panel">
						<div class="title">
							설정 제어판
							<i class="output" id="outputt">no data input</i>
						</div>
						<div class="controlpanel">
							<table class="tblayout">
								<tr>
									<td class="subtitlewth">차량 대수</td>
									<td class="paneltb"></td>
									<td class="tblyt"><div class="shw" id="carshw">1</div></td>
									<td class="tblytcenter" colspan="2">1 <input class="valuenum" id="carnum" type="range" min="1" max="10" value="1" onchange="show_carnn()" /> 10</td>
								</tr>
								<tr>
									<td>현재 배속</td>
									<td class="paneltb"></td>
									<td class="tblyt"><div class="shw" id="spdshw">1</div></td>
									<td class="tblytcenter" colspan="2">1 <input class="valuenum" id="spdnum" type="range" min="1" max="10" value="1" onchange="show_speed()"  /> 10</td>
								</tr>
								<tr>
									<td>시작/일시정지</td>
									<td class="paneltb"></td>
									<td class="tblyt"><button class="btn" id="play" onclick="start()">►</button></td>
									<td class="tblyt"><button class="btn" id="pause" onclick="stop()">I I</button></td>
									<td class="tblyt"><button class="btn" id="reload" onclick="window.location.reload()">⟳</button></td>
								</tr>
							</table>
						</div>
					</div>
				</td>
			</tr>
			<tr>
				<td class="controler">
					<div class="panel">
						<div class="title">
							선적현황
							<i class="output" id="crain1">0</i>
							<i class="output" id="crain2">0</i>
							<i class="output" id="crain3">0</i>
							<i class="output" id="crain4">0</i>
							<i class="output" id="craincheck1">0</i>
							<i class="output" id="craincheck2">0</i>
							<i class="output" id="craincheck3">0</i>
							<i class="output" id="craincheck4">0</i>
						</div>
						<div class="statuspanel">
							<table class="tblayout">
								<tr>
									<td class="subtitlewth">평균 대기시간</td>
									<td class="paneltb"></td>
									<td class="tblytright" id="waittime">005</td>
									<td class="tblytleft" >분</td>
									<td class="tblyt"></td>
								</tr>
								<tr>
									<td>평균 소요시간</td>
									<td class="paneltb"></td>
									<td class="tblytright" id="loadtime">030</td>
									<td class="tblytleft">분</td>
									<td class="tblyt"></td>
								</tr>
								<tr>
									<td>물건 적재율</td>
									<td class="paneltb"></td>
									<td class="tblytright" id="percent">010</td>
									<td class="tblytleft">%</td>
									<td class="tblyt"></td>
								</tr>
							</table>
						</div>
					</div>
				</td>
			</tr>
		</table>
	</body>
	<script src="https://code.jquery.com/jquery.min.js"></script>
	<script>
		// get traffic light data
		function mysql_conn() {
			$.ajax( {
				url: "getMysql.php",
				type: "GET",
				success: function(data) {
					$("#outputa").text(data);
					var info_temp = document.getElementById('outputa').innerText;
          
					var contact = JSON.parse(info_temp);
					var status_list = "light: "+ contact["light01"] + " " + contact["light02"];
					    status_list  +=   " "  + contact["light03"] + " " + contact["light04"];
					    status_list  +=   " "  + contact["light05"] + " " + contact["light06"];
					    status_list  +=   " "  + contact["light07"] + " " + contact["light08"];
					    status_list  +=   " "  + contact["light09"] + " " + contact["light10"];
					    status_list  +=   " "  + contact["light11"] + " " + contact["light12"];
					document.getElementById('outputt').innerHTML = status_list;
          
					// update light panel image
					var up		= "<img src='go.png'   width='45%' style='transform:rotate(270deg);'/>";
					var right	= "<img src='go.png'   width='45%' style='transform:rotate(  0deg);'/>";
					var down	= "<img src='go.png'   width='45%' style='transform:rotate( 90deg);'/>";
					var left	= "<img src='go.png'   width='45%' style='transform:rotate(180deg);'/>";
					var stay 	= "<img src='stay.png' width='45%' style='transform:rotate(270deg);'/>";
          
					// up 3 4 11 13 17
					// right 1 6 8 15
					// down 5 9 10 14 16
					// left 2 7 12 18
					
					var lightnum = [" ",
							"light01", "light02", "light03", 
							"light04", "light05", "light06", 
							"light07", "light08", "light09", 
							"light10", "light11", "light12"];
					var lightid = [" ",
						       "l1" , "l2" , "l3" ,
						       "l4" , "l5" , "l6" ,
						       "l7" , "l8" , "l9" ,
						       "l10", "l11", "l12"];
					
					for(var i = 1; i < lightid.length; i++) {
						if     (contact[lightnum[i]] == 0)   									document.getElementById(lightid[i]).innerHTML = stay;
						
						else if(contact[lightnum[i]] ==  3 || contact[lightnum[i]] ==  4 || contact[lightnum[i]] == 11 ||
						        contact[lightnum[i]] == 13 || contact[lightnum[i]] == 17)  					document.getElementById(lightid[i]).innerHTML = up;
						
						else if(contact[lightnum[i]] ==  1 || contact[lightnum[i]] ==  6 || contact[lightnum[i]] == 8 || 
							contact[lightnum[i]] == 15)  									document.getElementById(lightid[i]).innerHTML = right;
						
						else if(contact[lightnum[i]] ==  5 || contact[lightnum[i]] ==  9 || contact[lightnum[i]] == 10 ||
						        contact[lightnum[i]] == 14 || contact[lightnum[i]] == 16)  					document.getElementById(lightid[i]).innerHTML = down;
						
						else if(contact[lightnum[i]] ==  2 || contact[lightnum[i]] ==  7 || contact[lightnum[i]] == 12 ||
						        contact[lightnum[i]] == 18)  									document.getElementById(lightid[i]).innerHTML = left;
					}
				}
			} );
		}
		
		// get crain data
		function getCrain(crain, s) {
			$.ajax( {
				url: "getCrainMySql.php",
				type: "GET",
				data: {
					num : crain,
					senario : s
				},
				dataType: 'json',
				success: function(data) {
					if(data.success == false) {
						alert(data.success);
						alert(data.data);
						alert(data.msg);
						alert(data.code);
					}
					else {
						if     (crain == 1) {
							$("#crain1").text(data.data);
							$("#craincheck1").text("1");
						}
						else if(crain == 2) {
							$("#crain2").text(data.data);
							$("#craincheck2").text("1");
						}
						else if(crain == 3) {
							$("#crain3").text(data.data);
							$("#craincheck3").text("1");
						}
						else if(crain == 4) {
							$("#crain4").text(data.data);
							$("#craincheck4").text("1");
						}
					}
				}
			} );
		}
		
		// resize window
		window.addEventListener('resize', function(){
			drawMap();
		});
		
		// redraw Map
		window.onload = drawMap();
					 
  </script>
</html>
